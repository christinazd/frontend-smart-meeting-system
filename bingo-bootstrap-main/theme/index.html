<!DOCTYPE html>

<!--
 // WEBSITE: https://themefisher.com
 // TWITTER: https://twitter.com/themefisher
 // FACEBOOK: https://www.facebook.com/themefisher
 // GITHUB: https://github.com/themefisher/
-->

<html lang="en">
<head>
  <!-- ==============================
       BASIC META
       ============================== -->
  <meta charset="utf-8">
  <title>MeetPro</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="One page parallax responsive HTML Template">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Themefisher Bingo HTML Template v1.0">
  <link rel="shortcut icon" type="image/x-icon" href="images/l1.png" />

  <!-- ==============================
       FONTS
       ============================== -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- ==============================
       THEME / VENDOR CSS (kept)
       ============================== -->
  <link rel="stylesheet" href="plugins/themefisher-font/style.css">
  <link rel="stylesheet" href="plugins/bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="plugins/lightbox2/css/lightbox.min.css">
  <link rel="stylesheet" href="plugins/animate/animate.css">
  <link rel="stylesheet" href="plugins/slick/slick.css">
  <link rel="stylesheet" href="css/style.css">

  <!-- ==============================
       PREMIUM WHITE THEME POLISH
       ============================== -->
  <style>
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
      color: #0f172a;
      background: #ffffff;
    }
    .navigation { backdrop-filter: saturate(180%) blur(6px); }
    .hero-slider .hero-area h1 { font-weight: 800; letter-spacing: -0.015em; }
    .hero-slider .btn.btn-main { font-weight: 600; }

    /* ---------- custom slick arrows (no dots) ---------- */
    .hero-slider { position: relative; }
    .slick-arrow {
      position: absolute;
      top: 50%;
      z-index: 5;
      transform: translateY(-50%);
      width: 44px; height: 44px;
      border: none;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      display: grid; place-items: center;
      box-shadow: 0 6px 22px rgba(2,6,23,0.18);
      cursor: pointer;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
    }
    .slick-arrow:hover { transform: translateY(-50%) scale(1.03); background: #ffffff; }
    .slick-prev { left: 18px; }
    .slick-next { right: 18px; }
    .slick-arrow i { font-size: 18px; color: #111827; }

    /* ---------- dashboard cards ---------- */
    .dashboard-wrap { padding: 60px 0; }
    .card.premium {
      border: 1px solid #eef2f7;
      border-radius: 18px;
      box-shadow: 0 1px 2px rgba(16,24,40,.04), 0 8px 24px rgba(16,24,40,.07);
      background: #fff;
    }
    .card.premium .card-header{
      background: #fff; border-bottom: 1px solid #eef2f7; padding: 14px 18px;
    }
    .card.premium .card-body{ padding: 18px; }
    .card.premium .card-footer{ background:#fff; border-top:1px solid #eef2f7; padding:12px 18px; }

    :root{ --brand-primary:#4f46e5; --brand-accent:#22c55e; --ink-600:#475569; }
    .btn{ border-radius: 12px; font-weight: 600; letter-spacing: .01em; }
    .btn-primary{ background: var(--brand-primary); border-color: var(--brand-primary); }
    .btn-outline-primary{ color: var(--brand-primary); border-color: var(--brand-primary); }
    .btn-outline-secondary{ color: #334155; border-color: #cbd5e1; }

    .list-group-item{ border-color:#eef2f7; padding:14px 16px; }
    .table thead th{ border-color:#eef2f7; color:#334155; font-weight:700; background:#f8fafc; }
    .table td{ border-color:#eef2f7; vertical-align: middle; }
    .muted{ color:#64748b; }

    /* availability slots */
    .slot {
      display:inline-block; min-width:98px; padding:8px 10px; border-radius:10px;
      font-weight:600; font-size:13px; transition: transform .08s ease, box-shadow .12s ease;
      cursor:pointer; user-select:none;
    }
    .slot.available { background:#ecfdf5; border:1px dashed #10b981; color:#047857; }
    .slot.booked { background:#eef2ff; border:1px solid #6366f1; color:#3730a3; cursor:default; }
    .slot:hover { transform: translateY(-1px); box-shadow: 0 8px 22px rgba(2,6,23,0.06); }
    .slot.booked:hover { transform:none; box-shadow:none; }

    .dash-top h2{ font-weight:800; letter-spacing:-.02em; margin-bottom:4px; }
    .dash-top .kicker{ font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--ink-600); }
    .badge-info{ background:var(--brand-accent); color:#032d18; font-weight:700; }
    .meeting-actions .btn{ padding:4px 8px; font-size:12px; border-radius:10px; }

    .modal-content{
      border-radius: 18px; border:1px solid #eef2f7;
      box-shadow: 0 1px 2px rgba(16,24,40,.04), 0 12px 34px rgba(16,24,40,.12);
      background:#fff;
    }
    .modal-header{ border-bottom:1px solid #eef2f7; }
    .modal-footer{ border-top:1px solid #eef2f7; }

    /* entry micro-animation */
    [data-animate]{ opacity:0; transform:translateY(8px); transition:opacity .35s ease, transform .35s ease; }
    [data-animate].in{ opacity:1; transform:none; }
  </style>
</head>

<body id="body">
  <!-- PRELOADER REMOVED (kept snappy) -->

  <!-- ==============================
       NAVIGATION (UNCHANGED)
       ============================== -->
  <header class="navigation fixed-top">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light px-0">
        <a class="navbar-brand logo" href="index.html">
          <img loading="lazy" class="logo-default" src="images/l1.png" alt="logo" height="60" width="60" />
          
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navigation">
          <ul class="navbar-nav ml-auto text-center">
            <li class="nav-item"><a class="nav-link" href="index.html">Homepage</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="admin.html">Admin Panel</a></li>
            <li class="nav-item"><a class="nav-link" href="schedule.html">Schedule</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#!" id="navbarDropdown02" role="button" data-toggle="dropdown"
                 aria-haspopup="true" aria-expanded="false">
                Booking <i class="tf-ion-chevron-down"></i>
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown02">
                <li><a class="dropdown-item" href="meetingroombooking.html">Meeting Room Booking</a></li>
                <li><a class="dropdown-item" href="activemeetingsreen.html">Active Meeting Screen</a></li>
              </ul>
            </li>
            
            <li class="nav-item" id="logoutBTn">
              <a class="nav-link" href="login.html">Logout</a>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <!-- ==============================
       LOGIN/LOGOUT NAV STATE
       ============================== -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginLogoutNav = document.getElementById("loginLogoutNav");
      const isLoggedIn = localStorage.getItem("loggedIn") === "true";
      if (isLoggedIn) {
        loginLogoutNav.innerHTML = `<a class="nav-link" href="#" id="logoutBtn">Logout</a>`;
        document.getElementById("logoutBtn").addEventListener("click", function (e) {
          e.preventDefault();
          localStorage.removeItem("loggedIn");
          window.location.href = "index.html";
        });
      } else {
        loginLogoutNav.innerHTML = `<a class="nav-link" href="login.html">Login</a>`;
      }
    });
  </script>

  <!-- ==============================
       SLIDER (images stay the same) WITH ARROWS
       ============================== -->
  <div class="hero-slider">
    <div class="slider-item th-fullpage hero-area" style="background-image: url(images/slider/ma.jpg);">
      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center">
            <h1 data-duration-in=".3" data-animation-in="fadeInUp" data-delay-in=".1">All Your Meetings, <br> One Control Center</h1>
            <h4 style="color: white;" data-duration-in=".3" data-animation-in="fadeInUp" data-delay-in=".5">
              schedule, analyze, and act with confidence
            </h4>
            <a data-duration-in=".3" data-animation-in="fadeInUp" data-delay-in=".8" class="btn btn-main" href="about.html">Explore Us</a>
          </div>
        </div>
      </div>
    </div>
    <div class="slider-item th-fullpage hero-area" style="background-image: url(images/slider/nn.jpg);">
      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center">
            <h1 data-duration-in=".3" data-animation-in="fadeInDown" data-delay-in=".1">Meet Smarter</h1>
            <h4 style="color: white;" data-duration-in=".3" data-animation-in="fadeInDown" data-delay-in=".5">
              your dashboard that turns meeting static into strategic motion.
            </h4>
            <a data-duration-in=".3" data-animation-in="fadeInDown" data-delay-in=".8" class="btn btn-main" href="about.html">Explore Us</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       DASHBOARD (premium white)
       ========================================================= -->
  <section id="dashboard" class="dashboard-wrap">
    <div class="container" data-animate>
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div class="dash-top">
          <div class="kicker">Control Center</div>
          <h2 class="mb-0">Dashboard</h2>
          <div class="muted small" id="dashDate"></div>
        </div>
        <div class="btn-group" role="group" aria-label="Quick Actions">
          <button class="btn btn-primary" data-toggle="modal" data-target="#scheduleModal">
            <span class="mr-1"><i class="ti-plus"></i></span> Schedule Meeting
          </button>
          <button class="btn btn-outline-primary" id="joinNowBtn">
            <span class="mr-1"><i class="ti-video-camera"></i></span> Join Now
          </button>
          <a class="btn btn-outline-secondary" id="viewMinutesBtn" href="#!">
            <span class="mr-1"><i class="ti-agenda"></i></span> View Minutes
          </a>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8 mb-4" data-animate>
          <div class="card premium mb-4">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h5 class="mb-0">Upcoming Meetings</h5>
              <span class="badge badge-light" id="upcomingCount">0</span>
            </div>
            <ul class="list-group list-group-flush" id="upcomingList"></ul>
            <div class="card-footer text-right">
              <button class="btn btn-sm btn-outline-secondary" id="exportMeetingsBtn">Export (.json)</button>
            </div>
          </div>

          <div class="card premium">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h5 class="mb-0">Room Availability — Today</h5>
              <div class="small muted" id="availabilityDate"></div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-bordered mb-0">
                  <thead><tr id="roomsHeader"></tr></thead>
                  <tbody id="availabilityBody"></tbody>
                </table>
              </div>
              <div class="p-3 small muted">
                Tip: Click an empty slot to pre-fill the scheduler with that time & room.
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4" data-animate>
          <div class="card premium">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h5 class="mb-0">Notifications</h5>
              <span class="badge badge-info" id="notifCount">0</span>
            </div>
            <ul class="list-group list-group-flush" id="notifList"></ul>
            <div class="card-footer text-right">
              <button class="btn btn-sm btn-outline-secondary" id="clearNotifsBtn">Clear</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Schedule Modal -->
    <div class="modal fade" id="scheduleModal" tabindex="-1" role="dialog" aria-labelledby="scheduleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="scheduleModalLabel">Schedule a Meeting</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
          </div>
          <form id="scheduleForm">
            <div class="modal-body">
              <div class="form-group">
                <label>Title</label>
                <input type="text" class="form-control" id="mTitle" placeholder="e.g., Quarterly Strategy Review" required>
              </div>
              <div class="form-row">
                <div class="form-group col-7">
                  <label>Date & Start Time</label>
                  <input type="datetime-local" class="form-control" id="mStart" required>
                </div>
                <div class="form-group col-5">
                  <label>Duration (minutes)</label>
                  <input type="number" min="15" step="15" class="form-control" id="mDuration" value="60" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-6">
                  <label>Room</label>
                  <select class="form-control" id="mRoom"></select>
                </div>
                <div class="form-group col-6">
                  <label>Participants (emails, comma-separated)</label>
                  <input type="text" class="form-control" id="mParticipants" placeholder="a@x.com, b@y.com">
                </div>
              </div>
              <div class="form-group">
                <label>Description / Agenda</label>
                <textarea class="form-control" id="mDescription" rows="3" placeholder="Key points, goals..."></textarea>
              </div>
              <div class="alert alert-warning d-none" id="conflictAlert">
                <strong>Room conflict:</strong> This room is already booked for the selected time.
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-outline-secondary" type="button" data-dismiss="modal">Cancel</button>
              <button class="btn btn-primary" type="submit">Save Meeting</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Minutes Modal -->
    <div class="modal fade" id="minutesModal" tabindex="-1" role="dialog" aria-labelledby="minutesModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="minutesModalLabel">Meeting Minutes</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
          </div>
          <div class="modal-body" id="minutesBody"></div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
            <button class="btn btn-primary" id="saveMinutesBtn">Save Minutes</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ==============================
       DASHBOARD LOGIC
       ============================== -->
  <script>
  (function(){
    const ROOMS = ["Orion", "Nova", "Atlas", "Lyra"];
    const DAY_START_H = 8, DAY_END_H = 18;
    const KEY_MEETINGS = "sms_meetings";
    const KEY_MINUTES  = "sms_minutes";
    const KEY_NOTIFS   = "sms_notifications";

    const dashDateEl         = document.getElementById("dashDate");
    const availabilityDateEl = document.getElementById("availabilityDate");
    const roomsHeaderEl      = document.getElementById("roomsHeader");
    const availabilityBodyEl = document.getElementById("availabilityBody");
    const upcomingListEl     = document.getElementById("upcomingList");
    const upcomingCountEl    = document.getElementById("upcomingCount");
    const notifListEl        = document.getElementById("notifList");
    const notifCountEl       = document.getElementById("notifCount");

    const joinNowBtn         = document.getElementById("joinNowBtn");
    const viewMinutesBtn     = document.getElementById("viewMinutesBtn");
    const exportMeetingsBtn  = document.getElementById("exportMeetingsBtn");
    const clearNotifsBtn     = document.getElementById("clearNotifsBtn");

    const form               = document.getElementById("scheduleForm");
    const conflictAlert      = document.getElementById("conflictAlert");
    const mTitle             = document.getElementById("mTitle");
    const mStart             = document.getElementById("mStart");
    const mDuration          = document.getElementById("mDuration");
    const mRoom              = document.getElementById("mRoom");
    const mParticipants      = document.getElementById("mParticipants");
    const mDescription       = document.getElementById("mDescription");

    const minutesBody        = document.getElementById("minutesBody");
    const saveMinutesBtn     = document.getElementById("saveMinutesBtn");

    const now      = () => new Date();
    const toISO    = d => new Date(d).toISOString();
    const pad      = n => String(n).padStart(2,"0");
    const fmtTime  = d => `${pad(d.getHours())}:${pad(d.getMinutes())}`;
    const fmtDate  = d => d.toLocaleDateString(undefined,{weekday:'long', year:'numeric', month:'long', day:'numeric'});
    const parse    = v => new Date(v);
    const overlaps = (aStart, aEnd, bStart, bEnd) => aStart < bEnd && bStart < aEnd;

    function load(key, fallback){ try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch(e){ return fallback; } }
    function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    function addMinutes(date, minutes){ return new Date(date.getTime() + minutes*60000); }
    function startOfToday(){ const t = now(); return new Date(t.getFullYear(), t.getMonth(), t.getDate(), 0,0,0,0); }
    function isNowBetween(s, e){ const t = now(); return t >= s && t <= e; }
    function slugify(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
    function cryptoRandom(){
      if (window.crypto && crypto.getRandomValues) {
        const a = new Uint32Array(4); crypto.getRandomValues(a);
        return Array.from(a).map(x=>x.toString(16)).join("");
      }
      return 'id-' + Math.random().toString(36).slice(2);
    }

    // seed demo data once
    (function seed(){
      const seeded = load(KEY_MEETINGS, null);
      if (seeded) return;
      const t = now();
      const today = new Date(t.getFullYear(), t.getMonth(), t.getDate(), 10, 0, 0);
      const sample = [
        { id: cryptoRandom(), title:"Daily Standup",  room:"Orion", start: toISO(today),                 duration:30, participants:["team@x.com"],   description:"15-min sync",          join:"/meet/standup"},
        { id: cryptoRandom(), title:"UX Review",      room:"Lyra",  start: toISO(addMinutes(today,120)), duration:60, participants:["ux@x.com"],     description:"Design milestones",    join:"/meet/ux"},
        { id: cryptoRandom(), title:"Client Kickoff", room:"Atlas", start: toISO(addMinutes(today,240)), duration:45, participants:["client@x.com"], description:"Scope & deliverables", join:"/meet/kickoff"}
      ];
      save(KEY_MEETINGS, sample);
      save(KEY_MINUTES, {});
      save(KEY_NOTIFS, []);
    })();

    dashDateEl.textContent = fmtDate(now());
    availabilityDateEl.textContent = fmtDate(now());
    mRoom.innerHTML = ROOMS.map(r => `<option value="${r}">${r}</option>`).join("");
    roomsHeaderEl.innerHTML = ['<th class="align-middle">Time</th>'].concat(ROOMS.map(r => `<th>${r}</th>`)).join("");

    function renderAvailability(){
      const meetings = load(KEY_MEETINGS, []);
      const today = new Date();
      let rows = "";
      for(let h = DAY_START_H; h <= DAY_END_H; h++){
        const slotStart = new Date(today.getFullYear(), today.getMonth(), today.getDate(), h, 0,0,0);
        const slotEnd   = new Date(today.getFullYear(), today.getMonth(), today.getDate(), h+1, 0,0,0);
        const cells = [`<td class="muted small">${fmtTime(slotStart)}–${fmtTime(slotEnd)}</td>`];
        for(const room of ROOMS){
          const booked = meetings.some(m => {
            const ms = parse(m.start), me = addMinutes(ms, m.duration);
            return m.room === room && overlaps(ms, me, slotStart, slotEnd);
          });
          const cls = booked ? "booked" : "available";
          const label = booked ? "Booked" : "Available";
          cells.push(
            `<td><div class="slot ${cls}" data-room="${room}" data-start="${slotStart.toISOString()}">${label}</div></td>`
          );
        }
        rows += `<tr>${cells.join("")}</tr>`;
      }
      availabilityBodyEl.innerHTML = rows;
      availabilityBodyEl.querySelectorAll('.slot.available').forEach(el=>{
        el.addEventListener('click', ()=>{
          const room = el.getAttribute('data-room');
          const startISO = el.getAttribute('data-start');
          mRoom.value = room;
          mStart.value = startISO.slice(0,16);
          mDuration.value = 60;
          $('#scheduleModal').modal('show');
        });
      });
    }

    function renderUpcoming(){
      const meetings = load(KEY_MEETINGS, []);
      const upcoming = meetings
        .filter(m => parse(m.start) >= new Date(startOfToday().getTime() - 24*60*60*1000))
        .sort((a,b)=> new Date(a.start)-new Date(b.start));
      upcomingCountEl.textContent = upcoming.length;
      if(upcoming.length === 0){
        upcomingListEl.innerHTML = `<li class="list-group-item muted">No upcoming meetings.</li>`;
        return;
      }
      upcomingListEl.innerHTML = upcoming.map(m => {
        const s = parse(m.start);
        const e = addMinutes(s, m.duration);
        const live = isNowBetween(s,e);
        const liveBadge = live ? `<span class="badge badge-info ml-2">LIVE</span>` : '';
        return `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <div class="font-weight-bold">${m.title} ${liveBadge}</div>
              <div class="small muted">
                ${s.toLocaleDateString()} ${fmtTime(s)}–${fmtTime(e)} • Room ${m.room}
              </div>
            </div>
            <div class="meeting-actions btn-group">
              <a class="btn btn-outline-primary btn-sm" href="${m.join || '#!'}">Join</a>
              <button class="btn btn-outline-secondary btn-sm" data-id="${m.id}" data-action="minutes">Minutes</button>
              <button class="btn btn-outline-danger btn-sm" data-id="${m.id}" data-action="delete">Delete</button>
            </div>
          </li>`;
      }).join("");

      upcomingListEl.querySelectorAll('button[data-action]').forEach(btn=>{
        const id = btn.getAttribute('data-id');
        const action = btn.getAttribute('data-action');
        if(action === 'delete'){
          btn.addEventListener('click', ()=>{
            const meetings = load(KEY_MEETINGS, []);
            save(KEY_MEETINGS, meetings.filter(m=>m.id !== id));
            pushNotif("info", "Meeting deleted.");
            refresh();
          });
        }
        if(action === 'minutes'){
          btn.addEventListener('click', ()=> openMinutes(id));
        }
      });
    }

    function pushNotif(type, text){
      const notifs = load(KEY_NOTIFS, []);
      notifs.unshift({ id: cryptoRandom(), ts: Date.now(), type, text });
      save(KEY_NOTIFS, notifs.slice(0, 50));
      renderNotifs();
    }
    function renderNotifs(){
      const notifs = load(KEY_NOTIFS, []);
      notifCountEl.textContent = notifs.length;
      if(notifs.length === 0){
        notifListEl.innerHTML = `<li class="list-group-item muted">No notifications.</li>`;
        return;
      }
      notifListEl.innerHTML = notifs.map(n=>{
        const badge = n.type === 'warn' ? 'badge-danger' : (n.type==='info' ? 'badge-info' : 'badge-secondary');
        return `<li class="list-group-item d-flex justify-content-between align-items-center">
          <span>${n.text}</span>
          <span class="badge ${badge}">${new Date(n.ts).toLocaleTimeString()}</span>
        </li>`;
      }).join("");
    }

    function openMinutes(id){
      const meetings = load(KEY_MEETINGS, []);
      const minutes = load(KEY_MINUTES, {});
      const m = meetings.find(x=>x.id===id);
      if(!m) return;
      $('#minutesModal').modal('show');
      minutesBody.innerHTML = `
        <div class="mb-1 muted small">${new Date(m.start).toLocaleString()} • Room ${m.room}</div>
        <h5 class="mb-3">${m.title}</h5>
        <div class="form-group">
          <label>Minutes / Notes</label>
          <textarea class="form-control" id="minutesText" rows="8" placeholder="Decisions, action items, owners...">${minutes[id] || ''}</textarea>
        </div>`;
      saveMinutesBtn.onclick = function(){
        const text = document.getElementById('minutesText').value.trim();
        const map = load(KEY_MINUTES, {});
        map[id] = text;
        save(KEY_MINUTES, map);
        pushNotif('info', 'Minutes saved.');
        $('#minutesModal').modal('hide');
        refresh();
      }
    }

    viewMinutesBtn.addEventListener('click', function(e){
      e.preventDefault();
      const meetings = load(KEY_MEETINGS, []).sort((a,b)=> new Date(b.start)-new Date(a.start));
      if(meetings.length === 0){ pushNotif('warn','No meetings available yet.'); return; }
      openMinutes(meetings[0].id);
    });
    joinNowBtn.addEventListener('click', function(){
      const meetings = load(KEY_MEETINGS, []);
      const live = meetings.find(m=>{
        const s = parse(m.start), e = addMinutes(s, m.duration);
        return isNowBetween(s,e);
      });
      if(live){ window.location.href = live.join || '#!'; }
      else{ pushNotif('warn', 'No meeting is live right now.'); }
    });
    exportMeetingsBtn.addEventListener('click', function(){
      const data = JSON.stringify(load(KEY_MEETINGS, []), null, 2);
      const blob = new Blob([data], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'meetings.json'; a.click();
      URL.revokeObjectURL(url);
    });
    clearNotifsBtn.addEventListener('click', function(){
      save(KEY_NOTIFS, []);
      renderNotifs();
    });

    form.addEventListener('submit', function(e){
      e.preventDefault();
      conflictAlert.classList.add('d-none');

      const title = mTitle.value.trim();
      const start = parse(mStart.value);
      const duration = parseInt(mDuration.value, 10);
      const room = mRoom.value;
      const participants = (mParticipants.value || '').split(',').map(s=>s.trim()).filter(Boolean);
      const description = mDescription.value.trim();

      if(!title || isNaN(start.getTime()) || !duration || !room){ return; }

      const meetings = load(KEY_MEETINGS, []);
      const s = start, e2 = addMinutes(start, duration);
      const hasConflict = meetings.some(m=>{
        if(m.room !== room) return false;
        const ms = parse(m.start), me = addMinutes(ms, m.duration);
        return overlaps(ms, me, s, e2);
      });
      if(hasConflict){
        conflictAlert.classList.remove('d-none');
        return;
      }

      const newMeeting = {
        id: cryptoRandom(),
        title, start: start.toISOString(),
        duration, room, participants, description,
        join: "/meet/" + slugify(title)
      };
      meetings.push(newMeeting);
      save(KEY_MEETINGS, meetings);
      pushNotif('info', `Meeting "${title}" scheduled.`);
      $('#scheduleModal').modal('hide');
      form.reset();
      refresh();
    });

    function refresh(){ renderAvailability(); renderUpcoming(); renderNotifs(); }
    function scheduleTick(){
      const meetings = load(KEY_MEETINGS, []);
      const t = Date.now();
      meetings.forEach(m=>{
        const ms = parse(m.start).getTime();
        if (ms > t && (ms - t) <= 15*60*1000){
          pushNotif('info', `Upcoming: "${m.title}" at ${new Date(m.start).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`);
        }
      });
    }

    const startApp = () => {
      refresh();
      setInterval(scheduleTick, 60000);
      requestAnimationFrame(()=>{ document.querySelectorAll('[data-animate]').forEach(el=> el.classList.add('in')); });
    };
    if ('requestIdleCallback' in window) { requestIdleCallback(startApp, { timeout: 300 }); }
    else { setTimeout(startApp, 0); }
  })();
  </script>

  <!-- ==============================
       ORDERED JS (ensure Popper before Bootstrap)
       ============================== -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js" integrity="sha512-…"
          crossorigin="anonymous"></script>
  <script src="plugins/bootstrap/bootstrap.min.js"></script>
  <script src="plugins/slick/slick.min.js"></script>

  <script>
    // SLIDER INIT — arrows enabled, dots off, custom buttons
    $(function(){
      var $slider = $('.hero-slider');
      if ($slider.length && typeof $slider.slick === 'function') {
        $slider.slick({
          arrows: true,
          dots: false,          // <— no numbered dots
          autoplay: true,
          autoplaySpeed: 5000,
          fade: true,
          speed: 700,
          cssEase: 'ease-in-out',
          pauseOnHover: false,
          adaptiveHeight: false,
          prevArrow: '<button type="button" class="slick-prev" aria-label="Previous slide"><i class="tf-ion-chevron-left"></i></button>',
          nextArrow: '<button type="button" class="slick-next" aria-label="Next slide"><i class="tf-ion-chevron-right"></i></button>'
        });
      }
    });


    document.getElementById('logoutBtn').addEventListener('click', logout);

  // Example: fetch current user and show name
  (async () => {
    try {
      const res = await authFetch('/user'); // GET /api/user
      const me = await res.json();          // {id, name, email, ...}
      const el = document.getElementById('welcomeUser');
      if (el) el.textContent = me.name || me.email || 'User';
    } catch (e) {
      console.error('Failed to load user', e);
    }
  })();
  </script>
  <script src="js/guard.js"></script>
  <script src="js/api.js"></script>
  <script src="js/role-visibility.js"></script>

</body>
</html>
