<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Minutes of Meeting â€” MeetPro (Royale)</title>

  <!-- Bootstrap 4 -->
  <link rel="stylesheet" href="plugins/bootstrap/bootstrap.min.css" />
  <!-- Themefisher Fonts (kept) -->
  <link rel="stylesheet" href="plugins/themefisher-font/style.css" />
  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Quill (rich text) -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{
      --brand:#078992;
      --brand-2:#71bbbf;
      --glass-bg: rgba(255,255,255,0.66);
      --muted:#7d8a8a;
      --card-radius:20px;
    }
    html,body{height:100%}
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(180deg, #f6fbfb 0%, #ffffff 40%);
      padding-top: 108px; /* keep navbar intact */
      color: #0b2b2b;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* -------------------------
       NAVBAR: kept EXACT markup & colors
       ------------------------- */
     .navbar {
       position: fixed;      /* Stays in place */
    top: 0;
    left: 0;
    width: 100%;          /* Full width */
            /* Covers the whole page height */
    background-color: #078992; /* Your navbar color */
    z-index: -1;    
    
    }
    .navbar {
  padding-top: 15px;
  padding-bottom: 15px;
}
    .navbar .nav-link { color: #fff !important }
    .navbar .nav-link:hover { opacity:0.9; }
    .navbar-brand img { height:100px; width:auto; }
    .navbar .nav-item { margin-right: 15px; }
    .navbar-nav { margin-right: -20px !important; }

    /* -------------------------
       Royale Container & title
       ------------------------- */
    .container.royale { max-width:1100px; }
    .page-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }
    .page-title {
      font-size:1.9rem;
      font-weight:800;
      color:var(--brand);
      letter-spacing:0.2px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .page-sub {
      color:var(--muted);
      font-size:0.95rem;
    }

    /* -------------------------
       Glass cards + subtle neumorphism
       ------------------------- */
    .card.premium {
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.78));
      border-radius: var(--card-radius);
      box-shadow: 0 6px 18px rgba(8,20,20,0.06), inset 0 1px 0 rgba(255,255,255,0.6);
      padding:22px;
      margin-bottom:22px;
      transition: transform 220ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms;
      border: 1px solid rgba(7,137,146,0.06);
    }
    .card.premium:hover { transform: translateY(-6px); box-shadow: 0 18px 40px rgba(7,137,146,0.12); }

    .section-h {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .section-h h4 { margin:0; font-weight:700; color:#083233; }
    .section-h small { color:var(--muted); }

    /* -------------------------
       Attendees: deluxe pills with avatars
       ------------------------- */
    #attendeesList { display:flex; flex-wrap:wrap; gap:8px; }
    .attendee-pill {
      display:inline-flex;
      align-items:center;
      gap:10px;
      background: linear-gradient(180deg,#fff,#f6ffff);
      border-radius:999px;
      padding:8px 12px;
      box-shadow: 0 6px 12px rgba(3,22,22,0.04);
      border: 1px solid rgba(7,137,146,0.06);
      transition: transform 160ms, box-shadow 160ms;
      cursor:default;
    }
    .attendee-pill:hover{ transform: translateY(-3px); }
    .attendee-pill img{ width:36px;height:36px;border-radius:50%;object-fit:cover; border:2px solid #fff; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
    .attendee-name { font-weight:600; color:#093232; font-size:0.95rem; }
    .attendee-action {
      width:28px; height:28px; border-radius:50%; display:inline-grid; place-items:center;
      background:transparent;border:none;color:#9aa8a8;margin-left:6px;cursor:pointer;
    }
    .attendee-action:hover{ color:#ff5a5f; transform:scale(1.06); }

    .add-attendee {
      display:inline-flex; align-items:center; gap:8px;
      color:var(--brand); background:transparent; border:2px dashed rgba(7,137,146,0.12);
      padding:8px 12px; border-radius:12px; cursor:pointer;
    }
    .add-attendee:hover { background:rgba(7,137,146,0.03); }

    /* autocomplete dropdown */
    .attendees-autocomplete { position:relative; }
    .ac-list { position:absolute; left:0; right:0; top:46px; background:#fff; border-radius:10px; box-shadow:0 10px 24px rgba(4,22,22,0.08); max-height:220px; overflow:auto; z-index:50; border:1px solid rgba(7,137,146,0.06); }
    .ac-item { padding:8px 12px; display:flex; gap:10px; align-items:center; cursor:pointer; }
    .ac-item:hover{ background: #f6fffe; }

    /* -------------------------
       Agenda: quill editor card
       ------------------------- */
    #agendaEditor { height:160px; border-radius:12px; overflow:hidden; box-shadow: inset 0 1px 0 rgba(255,255,255,0.4); }

    /* -------------------------
       Actions: draggable cards with status toggles
       ------------------------- */
    #actionsContainer { display:flex; flex-direction:column; gap:10px; }
    .action-item {
      display:flex; align-items:center; gap:12px; padding:12px; border-radius:12px; background:linear-gradient(180deg,#ffffff,#fbffff); border:1px solid rgba(7,137,146,0.04);
      box-shadow: 0 6px 14px rgba(3,22,22,0.04);
      transition: transform 140ms;
    }
    .action-item .drag-handle { cursor:grab; color:var(--muted); width:28px; text-align:center; }
    .action-item .desc { flex:1; font-weight:600; color:#073232; min-width:120px; }
    .action-item .meta { display:flex; gap:8px; align-items:center; }
    .status-pill { padding:6px 10px; border-radius:999px; font-weight:700; font-size:0.82rem; color:#fff; }
    .status-todo { background:linear-gradient(90deg,#f59e0b,#f97316); }
    .status-doing { background:linear-gradient(90deg,#06b6d4,#078992); }
    .status-done { background:linear-gradient(90deg,#10b981,#059669); }

    /* -------------------------
       Attachments: cards with progress
       ------------------------- */
    .file-card { display:flex; gap:12px; align-items:center; padding:10px; background:linear-gradient(180deg,#ffffff,#fbfffe); border-radius:12px; border:1px solid rgba(7,137,146,0.04); box-shadow: 0 6px 12px rgba(3,22,22,0.03); }
    .file-card .file-icon{ width:44px; height:44px; border-radius:10px; display:grid; place-items:center; font-size:18px; background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#fff; }
    .file-card .file-meta { flex:1; }
    .file-card .file-actions { display:flex; gap:8px; align-items:center; }
    .file-progress { height:6px; border-radius:6px; background:rgba(7,137,146,0.12); overflow:hidden; margin-top:6px; }
    .file-progress > i { display:block; height:100%; width:0%; background:linear-gradient(90deg,#078992,#71bbbf); transition: width 450ms ease; }

    /* -------------------------
       Floating Actions (royale FAB)
       ------------------------- */
    .fab-wrap { position:fixed; right:28px; bottom:28px; z-index:120; display:flex; flex-direction:column; gap:10px; align-items:flex-end; }
    .fab {
      display:inline-flex; gap:10px; align-items:center; padding:8px 12px; border-radius:999px; color:#fff; border:none; font-weight:700; font-family:'Arial', sans-serif;
      background:linear-gradient(90deg,var(--brand),var(--brand-2)); box-shadow: 0 16px 36px rgba(7,137,146,0.18), 0 6px 12px rgba(3,22,22,0.06);
      cursor:pointer; transform-origin: center;
    }
    .fab .label{ display:inline-block; font-size:0.85rem; }
    .mini-fab { padding:12px; border-radius:12px; background:rgba(255,255,255,0.98); color:var(--brand); border:1px solid rgba(7,137,146,0.06); box-shadow: 0 8px 20px rgba(12,30,30,0.04); }

    /* -------------------------
       Responsive tweaks
       ------------------------- */
    @media (max-width:780px){
      .page-header{flex-direction:column; align-items:flex-start; gap:8px}
      .fab-wrap{ right:12px; bottom:12px; }
    }
    .btn-legendary.btn-sm {
  padding: 8px 18px;
  font-size: 0.88rem;
  border-radius: 20px;
  box-shadow: 0 4px 12px rgba(7,137,146,0.2);
}

  </style>
</head>
<body>

   <header class="navigation fixed-top">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light px-0">
        <a class="navbar-brand logo" href="index.html">
          
          
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navigation">
          <ul class="navbar-nav ml-auto text-center">
            <li class="nav-item"><a class="nav-link" href="index.html">Homepage</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="admin.html">Admin Panel</a></li>
            <li class="nav-item"><a class="nav-link" href="schedule.html">Schedule</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#!" id="navbarDropdown02" role="button" data-toggle="dropdown"
                 aria-haspopup="true" aria-expanded="false">
                Booking
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown02">
                <li><a class="dropdown-item" href="meetingroombooking.html">Meeting Room Booking</a></li>
                <li><a class="dropdown-item" href="activemeetingsreen.html">Active Meeting Screen</a></li>
                <li><a class="dropdown-item" href="mom.html">Minutes of Meeting</a></li>
              </ul>
            </li>
            <li class="nav-item" id="logoutBTn">
              <a class="nav-link" href="login.html">Logout</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <!-- ==============================
       LOGIN/LOGOUT NAV STATE
       ============================== -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginLogoutNav = document.getElementById("loginLogoutNav");
      const isLoggedIn = localStorage.getItem("loggedIn") === "true";
      if (isLoggedIn) {
        loginLogoutNav.innerHTML = `<a class="nav-link" href="#" id="logoutBtn">Logout</a>`;
        document.getElementById("logoutBtn").addEventListener("click", function (e) {
          e.preventDefault();
          localStorage.removeItem("loggedIn");
          window.location.href = "index.html";
        });
      } else {
        loginLogoutNav.innerHTML = `<a class="nav-link" href="login.html">Login</a>`;
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", function (e) {
  e.preventDefault();
  // Clear all auth-related localStorage keys and cookies so switching users works reliably
  ['token','user','role','loggedIn'].forEach(k => localStorage.removeItem(k));
  // Clear our session cookies (if present)
  document.cookie = 'sms_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
  document.cookie = 'sms_user=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
  window.location.href = "index.html";
});
  </script>

  <!-- Page Content -->
  <div class="container royale">
    <div class="page-header">
      <div>
        <div class="page-title">
          <i class="fa-solid fa-clipboard-list" style="color:var(--brand);font-size:1.3rem;"></i>
          Minutes of Meeting
        </div>
       
      </div>

      <div class="d-flex align-items-center gap-2">
        <button class="mini-fab" id="previewBtn" title="Preview">Preview</button>
        <button class="mini-fab" id="exportBtn" title="Export JSON"><i class="fa-regular fa-file-lines"></i></button>
      </div>
    </div>

    <!-- Attendees -->
    <div class="card premium" aria-labelledby="attendeesH">
      <div class="section-h">
        <h4 id="attendeesH">Attendees</h4>
        <small>Tap name to edit, drag to reorder (if needed)</small>
      </div>

      <div id="attendeesList" aria-live="polite">
        <!-- example pill -->
        <span class="attendee-pill" data-name="John Doe">
          <img src="images/user.jpg" alt="John">
          <span class="attendee-name">John Doe</span>
          <button class="attendee-action" title="Remove" aria-label="Remove attendee">&times;</button>
        </span>
      </div>

      <div style="margin-top:14px; display:flex; gap:10px; align-items:center;">
        <div class="attendees-autocomplete" style="flex:1;">
          <input id="attendeeInput" class="form-control" placeholder="Type to add attendee (press Enter)" />
          <div id="acList" class="ac-list" style="display:none;"></div>
        </div>
        <button id="addAttendeeBtn" class="add-attendee" aria-label="Add attendee">
          <i class="fa-solid fa-plus" style="color:var(--brand)"></i> Add
        </button>
      </div>
    </div>

    <!-- Agenda -->
    <div class="card premium" aria-labelledby="agendaH">
      <div class="section-h">
        <h4 id="agendaH">Agenda Items</h4>
        <small>Use formatting, bullets, and highlights</small>
      </div>

      <div id="agendaEditor"></div>
    </div>

    <!-- Decisions & Actions -->
    <div class="card premium" aria-labelledby="actionsH">
      <div class="section-h">
        <h4 id="actionsH">Decisions & Action Items</h4>
        <small>Drag to reorder â€¢ Click status to cycle (TODO â†’ DOING â†’ DONE)</small>
      </div>

      <div id="actionsContainer">
        <div class="action-item" data-id="a1">
          <div class="drag-handle" title="Drag"><i class="fa-solid fa-grip-lines"></i></div>
          <div class="desc">Follow-up: finalize Q3 budget</div>
          <div class="meta">
            <select class="form-control assignee">
              <option>Assign to...</option><option>John Doe</option><option>Jane Smith</option>
            </select>
            <div class="status-pill status-todo" data-status="todo" title="Toggle status">TODO</div>
            <button class="btn btn-sm" title="Remove" onclick="this.closest('.action-item').remove()">âœ•</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <button id="addAction" class="btn btn-outline-primary"><i class="fa-solid fa-plus"></i> Add Action Item</button>
      </div>
    </div>

    <!-- Attachments -->
    <div class="card premium" aria-labelledby="filesH">
      <div class="section-h">
        <h4 id="filesH">Attachments</h4>
        <small>Drag & drop or click to upload. Preview & remove files.</small>
      </div>

      <div class="dropzone" id="dropzone" tabindex="0" role="button" aria-label="File upload">
        <div style="font-size:1.05rem; font-weight:700; color:var(--brand)"><i class="fa-solid fa-cloud-arrow-up"></i> Drop files or click to upload</div>
        <div style="color:var(--muted); margin-top:6px;">Supported: .pdf .docx .xlsx .pptx .png .jpg</div>
      </div>

      <input type="file" id="fileInput" class="d-none" multiple>
      <div id="filePreview" style="margin-top:12px; display:flex;flex-direction:column; gap:10px;"></div>
    </div>

  </div>
<br>
<br>

  <!-- Royale FABs -->
  <div class="fab-wrap">
    <div class="fab-wrap-inner">
      <div class="fab-wrap-floating" style="display:flex;flex-direction:column;align-items:flex-end;gap:25px;">
        <div class="fab" id="saveDraft"><i class="fa-solid fa-floppy-disk"></i><span class="label">Save Draft</span></div>
        <div class="fab" id="finalizeShare"><i class="fa-solid fa-paper-plane"></i><span class="label">Finalize & Share</span></div>
      </div>
    </div>
  </div>

  <!-- Preview Modal (simple) -->
  <div class="modal fade" id="previewModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
      <div class="modal-content" style="border-radius:14px; overflow:hidden;">
        <div class="modal-header" style="background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#fff;">
          <h5 class="modal-title">Meeting Preview</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color:#fff;">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="previewBody" style="max-height:60vh; overflow:auto;"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button id="downloadPdf" type="button" class="btn btn-primary">Download PDF</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS: Core libs -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <script src="plugins/bootstrap/bootstrap.min.js"></script>

  <!-- Quill -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <!-- Sortable (drag & drop reorder) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <script>
    // -------------------------
    // Initialize Quill (Agenda)
    // -------------------------
    const quill = new Quill('#agendaEditor', {
      theme: 'snow',
      placeholder: 'Write agenda items here â€” use bullets, bold, and links.',
      modules: { toolbar: [['bold','italic','underline'], [{ 'list': 'ordered'}, { 'list': 'bullet' }], ['link'], ['clean']] }
    });
    // set initial content (from your old textarea)
    quill.root.innerHTML = "Discuss quarterly results, Approve budget, Plan next sprint";

    // -------------------------
    // Attendees logic (autocomplete & pills)
    // -------------------------
    const samplePeople = [
      {name:'John Doe', avatar:'images/user.jpg'},
      {name:'Jane Smith', avatar:'images/user2.jpg'},
      {name:'Amir Khalil', avatar:'images/user3.jpg'},
      {name:'Sara Haddad', avatar:'images/user4.jpg'}
    ];
    const attendeesList = document.getElementById('attendeesList');
    const attendeeInput = document.getElementById('attendeeInput');
    const acList = document.getElementById('acList');

    function renderAutocomplete(q) {
      acList.innerHTML = '';
      if(!q) { acList.style.display='none'; return; }
      const matches = samplePeople.filter(p=>p.name.toLowerCase().includes(q.toLowerCase()));
      matches.forEach(p=>{
        const item = document.createElement('div');
        item.className='ac-item';
        item.innerHTML = `<img src="${p.avatar}" style="width:36px;height:36px;border-radius:50%;object-fit:cover;margin-right:8px"><div>${p.name}</div>`;
        item.onclick = ()=> { addAttendee(p.name,p.avatar); attendeeInput.value=''; acList.style.display='none'; };
        acList.appendChild(item);
      });
      if(matches.length) acList.style.display='block'; else acList.style.display='none';
    }

    attendeeInput.addEventListener('input', (e)=> renderAutocomplete(e.target.value));
    attendeeInput.addEventListener('keydown', (e)=> {
      if(e.key === 'Enter' && attendeeInput.value.trim()){
        addAttendee(attendeeInput.value.trim(), 'images/user.jpg');
        attendeeInput.value='';
        acList.style.display='none';
      }
    });

    document.getElementById('addAttendeeBtn').addEventListener('click', ()=> {
      const v = attendeeInput.value.trim(); if(!v) return;
      addAttendee(v, 'images/user.jpg'); attendeeInput.value='';
    });

    function addAttendee(name, avatar){
      const span = document.createElement('span');
      span.className='attendee-pill';
      span.setAttribute('data-name', name);
      span.innerHTML = `<img src="${avatar}" alt="${name}"><span class="attendee-name">${name}</span><button class="attendee-action" title="Remove" aria-label="Remove attendee">&times;</button>`;
      span.querySelector('.attendee-action').addEventListener('click', ()=> span.remove());
      span.querySelector('.attendee-name').addEventListener('click', ()=> {
        const newName = prompt('Edit attendee name:', name); if(newName) { span.querySelector('.attendee-name').textContent = newName; span.dataset.name = newName; }
      });
      attendeesList.appendChild(span);
    }

    // -------------------------
    // Actions: add / status cycle / reorder
    // -------------------------
    const actionsContainer = document.getElementById('actionsContainer');
    document.getElementById('addAction').addEventListener('click', ()=> {
      const d = document.createElement('div');
      d.className = 'action-item';
      d.innerHTML = `<div class="drag-handle"><i class="fa-solid fa-grip-lines"></i></div>
        <input type="text" class="desc form-control" placeholder="Describe the task">

        <div class="meta">
          <select class="form-control assignee"><option>Assign to...</option></select>
          <div class="status-pill status-todo" data-status="todo">TODO</div>
          <button class="btn btn-sm" title="Remove">âœ•</button>
        </div>`;
      // fill assignee options from current attendees
      const sel = d.querySelector('select.assignee');
      document.querySelectorAll('.attendee-pill .attendee-name').forEach(an=>{
        const opt = document.createElement('option'); opt.textContent = an.textContent; sel.appendChild(opt);
      });
      d.querySelector('.status-pill').addEventListener('click', toggleStatus);
      d.querySelector('button').addEventListener('click', ()=> d.remove());
      actionsContainer.appendChild(d);
    });

    // status cycle
    function toggleStatus(e){
      const el = e.currentTarget;
      const s = el.dataset.status;
      if(s==='todo'){ el.dataset.status='doing'; el.className='status-pill status-doing'; el.textContent='DOING'; }
      else if(s==='doing'){ el.dataset.status='done'; el.className='status-pill status-done'; el.textContent='DONE'; }
      else { el.dataset.status='todo'; el.className='status-pill status-todo'; el.textContent='TODO'; }
    }
    // attach to existing status pills
    document.querySelectorAll('.status-pill').forEach(p=>p.addEventListener('click', toggleStatus));

    // Drag & drop reorder using Sortable
    Sortable.create(actionsContainer, {
      handle: '.drag-handle',
      animation: 160,
      ghostClass: 'sortable-ghost'
    });

    // -------------------------
    // Attachments: dropzone, preview & simulated upload
    // -------------------------
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const filePreview = document.getElementById('filePreview');

    dropzone.addEventListener('click', ()=> fileInput.click());
    dropzone.addEventListener('dragover', (e)=> { e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave', ()=> dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', (e)=> { e.preventDefault(); dropzone.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
    fileInput.addEventListener('change', ()=> handleFiles(fileInput.files));

    function iconForName(name){
      const ext = name.split('.').pop().toLowerCase();
      if(['png','jpg','jpeg','gif'].includes(ext)) return '<i class="fa-solid fa-image"></i>';
      if(['pdf'].includes(ext)) return '<i class="fa-solid fa-file-pdf"></i>';
      if(['doc','docx'].includes(ext)) return '<i class="fa-solid fa-file-word"></i>';
      if(['xls','xlsx'].includes(ext)) return '<i class="fa-solid fa-file-excel"></i>';
      if(['ppt','pptx'].includes(ext)) return '<i class="fa-solid fa-file-powerpoint"></i>';
      return '<i class="fa-solid fa-file"></i>';
    }

    function handleFiles(files){
      Array.from(files).forEach(file=>{
        const fc = document.createElement('div'); fc.className='file-card';
        fc.innerHTML = `<div class="file-icon">${iconForName(file.name)}</div>
          <div class="file-meta">
            <div style="font-weight:700">${file.name}</div>
            <div style="font-size:0.86rem;color:var(--muted);margin-top:4px">${(file.size/1024).toFixed(1)} KB</div>
            <div class="file-progress"><i></i></div>
          </div>
          <div class="file-actions">
            <button class="btn btn-sm" title="Remove">âœ•</button>
          </div>`;
        fc.querySelector('button').addEventListener('click', ()=> fc.remove());
        filePreview.prepend(fc);

        // simulate upload progress
        const bar = fc.querySelector('.file-progress > i');
        let pct = 0;
        const t = setInterval(()=> {
          pct += Math.random()*22;
          if(pct >= 100) { pct = 100; bar.style.width = '100%'; clearInterval(t); setTimeout(()=> {
            // subtle done pulse
            fc.style.boxShadow = '0 20px 40px rgba(7,137,146,0.12)';
          },200); }
          bar.style.width = pct + '%';
        }, 220);
      });
    }

    // -------------------------
    // Save Draft & Finalize (simulated)
    // -------------------------
    function collectData(){
      const attendees = Array.from(document.querySelectorAll('.attendee-pill')).map(p=>p.dataset.name || p.querySelector('.attendee-name').textContent);
      const agenda = quill.root.innerHTML;
      const actions = Array.from(document.querySelectorAll('.action-item')).map(ai=>{
        return {
          description: ai.querySelector('.desc').textContent,
          assignee: ai.querySelector('select.assignee') ? ai.querySelector('select.assignee').value : '',
          status: ai.querySelector('.status-pill') ? ai.querySelector('.status-pill').dataset.status : 'todo'
        };
      });
      const files = Array.from(document.querySelectorAll('.file-card')).map(f=>({
        name: f.querySelector('.file-meta > div').textContent,
      }));
      return { attendees, agenda, actions, files, timestamp: new Date().toISOString() };
    }

    document.getElementById('saveDraft').addEventListener('click', ()=> {
      const data = collectData();
      localStorage.setItem('mom_draft_v1', JSON.stringify(data));
      showToast('Draft saved locally âœ”');
    });

    document.getElementById('finalizeShare').addEventListener('click', ()=> {
      const data = collectData();
      // simulated share â†’ open preview modal
      document.getElementById('previewBody').innerHTML = renderPreviewHTML(data);
      $('#previewModal').modal('show');
    });

    // Export JSON
    document.getElementById('exportBtn').addEventListener('click', ()=> {
      const data = collectData();
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='meeting.json'; a.click(); URL.revokeObjectURL(url);
      showToast('Exported meeting JSON âœ”');
    });

    document.getElementById('previewBtn').addEventListener('click', ()=> {
      const data = collectData();
      document.getElementById('previewBody').innerHTML = renderPreviewHTML(data);
      $('#previewModal').modal('show');
    });

    function renderPreviewHTML(d){
      return `
        <div style="padding:12px 6px;">
          <h3 style="color:var(--brand);margin-top:4px">Minutes â€” Preview</h3>
          <p style="color:var(--muted);font-size:0.95rem">Generated: ${new Date(d.timestamp).toLocaleString()}</p>
          <h5 style="margin-top:18px">Attendees</h5>
          <ul>${d.attendees.map(a=>`<li>${a}</li>`).join('')}</ul>
          <h5 style="margin-top:12px">Agenda</h5>
          <div style="background:#fbfffe;padding:12px;border-radius:10px;border:1px solid rgba(7,137,146,0.04)">${d.agenda}</div>
          <h5 style="margin-top:12px">Actions</h5>
          <ol>${d.actions.map(a=>`<li><strong>${a.description}</strong> â€” <em>${a.assignee||'Unassigned'}</em> <span style="color:${a.status==='done'? '#059669': a.status==='doing' ? '#078992' : '#f97316'}">[${a.status.toUpperCase()}]</span></li>`).join('')}</ol>
          <h5 style="margin-top:12px">Attachments</h5>
          <ul>${d.files.map(f=>`<li>${f.name}</li>`).join('')}</ul>
        </div>
      `;
    }

    // small toast (ephemeral)
    function showToast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed'; t.style.right='28px'; t.style.bottom='120px'; t.style.background='linear-gradient(90deg,var(--brand),var(--brand-2))';
      t.style.color='#fff'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.boxShadow='0 12px 30px rgba(7,137,146,0.16)';
      document.body.appendChild(t);
      setTimeout(()=> t.style.opacity='0',1600);
      setTimeout(()=> t.remove(),2000);
    }

    // keyboard accessible: enter to save draft (cmd/ctrl+S)
    window.addEventListener('keydown', (e)=> {
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){ e.preventDefault(); document.getElementById('saveDraft').click(); }
    });

    // small init: attach status toggle for already present pills
    document.querySelectorAll('.status-pill').forEach(p=>p.addEventListener('click', toggleStatus));
    // populate any existing action-item select options from attendees
    function populateActionAssignees(){
      const names = Array.from(document.querySelectorAll('.attendee-pill .attendee-name')).map(n=>n.textContent);
      document.querySelectorAll('select.assignee').forEach(sel=>{
        // clear current non-first options
        Array.from(sel.querySelectorAll('option')).slice(1).forEach(o=>o.remove());
        names.forEach(n=> sel.appendChild(new Option(n,n)));
      });
    }
    // re-populate when attendees change
    const observer = new MutationObserver(()=> populateActionAssignees());
    observer.observe(attendeesList, { childList:true, subtree:true });

    // accessibility: allow dropzone to open file dialog via keyboard
    dropzone.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') fileInput.click(); });

  </script>
  <script src="js/guard.js"></script>
  <script src="js/api.js"></script>
  <script src="js/role-visibility.js"></script>
</body>
</html>
